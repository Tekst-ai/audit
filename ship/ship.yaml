---
assets:
  v1:
    - github:
        repo: dexhorthy/api
        path: ship/k8s
        dest: ./
        source: private
        # todo version me
        ref: ship
    - github:
        repo: dexhorthy/api
        path: ship/templates
        dest: ./
        source: private
        # todo version me
        ref: ship
    - inline:
        dest: scripts/install.sh
        mode: 755
        contents: |
          #!/bin/sh
          kubectl create namespace {{repl ConfigOption "namespace"}}
          kustomize build installer/overlays/ship | kubectl apply -f -
    - inline:
        dest: scripts/test.sh
        mode: 755
        contents: |
          #!/bin/sh
          echo "tested nothing"



lifecycle:
  v1:
    - config: {}
    - render: {}
    - kustomize:
        base_path: "installer/ship/k8s"
        dest: installer/overlays/ship
    - message:
        contents: |
          Assets are almost ready. Fill out the file at

              ./installer/ship/templates/secrets.yaml

          and then deploy that to your cluster.

          Then, you can use

              kubectl create namespace {{repl ConfigOption "namespace"}}
              kustomize build installer/overlays/ship | kubectl apply -f -

          To deploy retraced to your cluster.

config:
  v1:
    - title: Basics
      name: basics
      items:
      - name: namespace
        title: Kubernetes Namespace
        help_text: "The Namespace that you'll deploy retraced into"
        type: text
        default: 'retraced'
      - name: hostname
        title: Hostname
        type: text
        help_text: "The hostname that you will use to communicate with the retraced API"
        default: 'http://api.{{repl ConfigOption "namespace"}}.svc.cluster.local'

    - title: Elasticsearch
      name: elasticsearch
      items:
      - name: elasticsearch_nodes
        title: Elasticsearch Nodes
        help_text: "A comma-separated list of one or more Elasticsearch connection strings"
        type: text
        default: 'https://some-user:s3cr3t@ealsticsearch.internal.somebigbank.com'

    - title: Postgres
      name: postgres
      items:
      - name: postgres_host
        title: Host
        type: text
        help_text: "The host of a postgres server to use"
        default: 'postgres.internal.somebigbank.com'
      - name: postgres_port
        title: Port
        type: text
        help_text: "The port of a postgres server to use"
        default: '5432'
      - name: postgres_database
        title: Database
        type: text
        help_text: "The name of the database to use"
        default: 'retraced'
      - name: postgres_user
        title: User
        type: text
        help_text: "The user to connect as"
        default: 'retraced'
      - name: postgres_password
        title: Password
        type: text
        help_text: "The password to use"
        default: 'shhhsecret'
